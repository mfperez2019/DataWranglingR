---
title: "Clase3"
author: "Mafer Pérez"
date: "12 de agosto de 2019"
output: html_document
---

```{r, echo = TRUE}
library(tidyverse)
library(readr)
players_score <- read_csv(file = "C:/Users/Mafer/Desktop/GitHub/DataWranglingR/Tidy/football-world-cup-2018-dataset/Players_Score.csv")
 view(players_score)

players_score$cambio<-str_extract_all(players_score$Apps, "\\([^)]*\\)","")
players_score$cambio<-str_extract_all(players_score$cambio,"[0-9]+")
players_score$Apps<-str_replace_all(players_score$Apps, "\\([^)]*\\)","")

### Volver todas las variables numericas a formato numerico
numbers <- c("age", "Apps", "cambio", "Goals", "Assists", "Yel", "Red", "SpG", "PS", "AerialsWon", "MotM", "Rating")
players_score[numbers] <- lapply(players_score[numbers], as.numeric)
head(players_score) %>% view()

players_score[numbers] <- players_score[numbers] %>% replace_na(list(age=0, Goals=0, Assists=0, Yel=0, Red=0, SpG=0, PS=0, AerialsWon=0, MotM=0, Rating=0, cambio=0))
players_score

###filter
filter(players_score, club=="Real Madrid", age <30)

filter(players_score, club %in% c("Real Madrid", "Barcelona", age <30))

###prmer filtro pero con pope
players_score %>% 
  filter(club=="Real Madrid")

###Seleccionamos unicamente las columnas de club, edad y filtreamos por club
filter(select(players_score,club,age), club=="Real Madrid")

##Seleccionemos únicamente las columnas de club y edad y filtremos por club
players_score %>% 
  select(club,age) %>% 
  filter(club== "Real Madrid")

##Rate entre minuto sobre goal
players_score %>% 
  mutate(Goal_Rate = Mins/Goals) %>% 
  arrange(desc(Goal_Rate))

##Una posible Solución
players_score %>% 
  filter(Goals > 0) %>% 
  mutate(Goal_Rate = Mins/Goals) %>% 
  arrange(desc(Goal_Rate)) %>% 
  distinct()

###equipo goleador
players_score %>% 
  select(club, Goals) %>% 
  group_by(club) %>% 
  summarise(team_goals = sum(Goals)) %>% 
  arrange(desc(team_goals))

players_score %>% 
  select(player, PS, club)
```
